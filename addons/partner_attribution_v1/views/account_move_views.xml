<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_move_form_inherit_partner_attribution_v1" model="ir.ui.view">
        <field name="name">account.move.form.partner_attribution_v1</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">

            <!-- ============================= -->
            <!-- Header Buttons -->
            <!-- ============================= -->
            <xpath expr="//header" position="inside">

                <!-- Create Commission Bill (only when it will actually work) -->
                <button name="action_create_commission_bill"
                        type="object"
                        string="Create Commission Bill"
                        class="btn-primary"
                        invisible="
                            move_type != 'out_invoice'
                            or state != 'posted'
                            or payment_state != 'paid'
                            or not attributed_partner_id
                            or commission_amount &lt;= 0
                            or commission_vendor_bill_id
                        "/>

                <!-- Optional: show a View button when bill exists (no feature reduction) -->
                <button name="%(account.action_move_in_invoice_type)d"
                        type="action"
                        string="View Commission Bill"
                        class="btn-secondary"
                        invisible="not commission_vendor_bill_id"
                        context="{'default_move_type': 'in_invoice', 'active_id': commission_vendor_bill_id}"/>
            </xpath>

            <!-- ============================= -->
            <!-- Fields -->
            <!-- ============================= -->
            <xpath expr="//sheet//group" position="inside">
                <group string="Partner Attribution (v1)">
                    <field name="attributed_partner_id"
                           readonly="attribution_locked or state != 'draft'"/>
                    <field name="attribution_locked" readonly="1"/>
                    <field name="attribution_locked_at" readonly="1"/>
                    <field name="attribution_locked_by" readonly="1"/>
                </group>

                <group string="Partner Commission (v1)"
                       invisible="move_type != 'out_invoice'">
                    <field name="commission_bill_state" readonly="1"/>
                    <field name="commission_rate_used" readonly="1"/>
                    <field name="commission_amount" readonly="1"/>
                    <field name="commission_vendor_bill_id" readonly="1"
                           invisible="not commission_vendor_bill_id"/>
                </group>
            </xpath>

        </field>
    </record>
</odoo>