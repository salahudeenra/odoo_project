<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <template id="portal_my_home_inherit_partner" inherit_id="portal.portal_my_home" name="Portal Home Partner Link">
    <xpath expr="//div[contains(@class,'o_portal_docs')]" position="inside">
      <a class="btn btn-outline-primary me-2 mb-2" href="/partners/portal">
        Partner Portal
      </a>
    </xpath>
  </template>

  <template id="portal_partner_dashboard" name="Partner Portal Dashboard">
    <t t-call="portal.portal_layout">
      <t t-set="breadcrumbs_searchbar" t-value="True"/>
      <div class="container o_portal_wrap py-4">
        <h1 class="mb-3">Partner Portal</h1>

        <div class="row g-3">

          <!-- Profile -->
          <div class="col-12 col-lg-6">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">Profile</h5>
                <div><strong>Name:</strong> <span t-esc="partner.name"/></div>
                <div><strong>Email:</strong> <span t-esc="partner.email or ''"/></div>
                <div><strong>Phone:</strong> <span t-esc="partner.phone or ''"/></div>
                <div class="mt-2"><strong>Role:</strong> <span t-esc="role_label or ''"/></div>

                <t t-if="partner.partner_uid">
                  <div class="mt-2"><strong>Partner ID:</strong> <span t-esc="partner.partner_uid"/></div>
                </t>
                <t t-if="partner.partner_code">
                  <div><strong>Partner Code:</strong> <span t-esc="partner.partner_code"/></div>
                </t>

                <t t-if="referral_url">
                  <div class="mt-3">
                    <strong>Referral Link:</strong>

                    <div class="input-group input-group-sm mt-1">
                      <input type="text" class="form-control" readonly="readonly" t-att-value="referral_url"/>
                      <button class="btn btn-outline-secondary" type="button"
                              onclick="this.previousElementSibling.focus(); this.previousElementSibling.select(); document.execCommand('copy');">
                        Copy
                      </button>
                    </div>

                    <div class="text-muted small mt-1">
                      Tip: share this link to attribute customers to you.
                    </div>
                  </div>
                </t>

              </div>
            </div>
          </div>

          <!-- KYC -->
          <div class="col-12 col-lg-6">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">Compliance (KYC)</h5>

                <div class="d-flex flex-wrap gap-2 mb-2">
                  <span class="badge text-bg-secondary">
                    KYC: <t t-esc="partner.kyc_status or ''"/>
                  </span>

                  <t t-if="partner.bank_verified">
                    <span class="badge text-bg-success">Bank Verified</span>
                  </t>
                  <t t-else="">
                    <span class="badge text-bg-warning">Bank Not Verified</span>
                  </t>

                  <t t-if="partner.kyc_blocked">
                    <span class="badge text-bg-danger">KYC Blocked</span>
                  </t>
                </div>

                <t t-if="partner.kyc_verified_on">
                  <div class="mb-2">
                    <strong>Verified On:</strong>
                    <span t-esc="partner.kyc_verified_on"/>
                  </div>
                </t>

                <form action="/partners/portal/profile/submit" method="post" class="mt-3">
                  <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                  <div class="mb-2">
                    <label class="form-label">Phone (update)</label>
                    <input class="form-control" type="text" name="phone" t-att-value="partner.phone or ''"/>
                  </div>
                  <div class="mb-2">
                    <label class="form-label">KYC Note (for admin)</label>
                    <textarea class="form-control" name="kyc_note" rows="3"><t t-esc="partner.kyc_note or ''"/></textarea>
                  </div>
                  <button class="btn btn-primary btn-sm" type="submit">
                    Submit for Review (sets Pending)
                  </button>
                </form>

              </div>
            </div>
          </div>

          <!-- Ledger Summary Cards -->
          <div class="col-12">
            <div class="row g-3">
              <div class="col-12 col-md-4">
                <div class="card h-100">
                  <div class="card-body">
                    <div class="text-muted small">On Hold</div>
                    <div class="fs-4 fw-semibold">
                      <t t-esc="(partner.company_id and partner.company_id.currency_id and partner.company_id.currency_id.symbol) or ''"/>
                      <t t-esc="('%.2f' % (on_hold_amount or 0.0))"/>
                    </div>
                    <div class="text-muted small mt-1">Waiting for compliance/vendor bill/payment.</div>
                  </div>
                </div>
              </div>
              <div class="col-12 col-md-4">
                <div class="card h-100">
                  <div class="card-body">
                    <div class="text-muted small">Payable</div>
                    <div class="fs-4 fw-semibold">
                      <t t-esc="(partner.company_id and partner.company_id.currency_id and partner.company_id.currency_id.symbol) or ''"/>
                      <t t-esc="('%.2f' % (payable_amount or 0.0))"/>
                    </div>
                    <div class="text-muted small mt-1">Eligible for payout batch.</div>
                  </div>
                </div>
              </div>
              <div class="col-12 col-md-4">
                <div class="card h-100">
                  <div class="card-body">
                    <div class="text-muted small">Paid</div>
                    <div class="fs-4 fw-semibold">
                      <t t-esc="(partner.company_id and partner.company_id.currency_id and partner.company_id.currency_id.symbol) or ''"/>
                      <t t-esc="('%.2f' % (paid_amount or 0.0))"/>
                    </div>
                    <div class="text-muted small mt-1">Vendor bill paid.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Commission Ledger -->
          <!-- (UNCHANGED from your version) -->
          <!-- ... keep your ledger table exactly as-is ... -->

          <!-- Documents -->
          <div class="col-12">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Documents</h5>

                <form action="/partners/portal/documents/upload" method="post" enctype="multipart/form-data" class="mb-3">
                  <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                  <div class="d-flex gap-2 flex-wrap align-items-center">
                    <input class="form-control" type="file" name="document" required="required"/>
                    <button class="btn btn-outline-primary" type="submit">Upload</button>
                  </div>
                  <div class="text-muted small mt-2">
                    Upload contracts / CoC / VAT proof / bank proof. Admin reviews in backend.
                  </div>
                </form>

                <t t-if="partner_docs and len(partner_docs) &gt; 0">
                  <div class="list-group">
                    <t t-foreach="partner_docs" t-as="d">

                      <!-- portal-safe download link: access_token when available -->
                      <t t-set="dl_url"
                         t-value="'/web/content/%s?download=true%s' % (d.id, (d.access_token and ('&amp;access_token=%s' % d.access_token)) or '')"/>

                      <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                         t-att-href="dl_url"
                         target="_blank"
                         rel="noopener"
                         referrerpolicy="no-referrer">
                        <span><t t-esc="d.name or ('Attachment %s' % d.id)"/></span>
                        <span class="text-muted small">Download</span>
                      </a>
                    </t>
                  </div>
                </t>
                <t t-else="">
                  <div class="alert alert-secondary mb-0">
                    No documents uploaded yet.
                  </div>
                </t>

              </div>
            </div>
          </div>

          <!-- Role-based sections + Help -->
          <!-- (UNCHANGED from your version) -->

        </div>
      </div>
    </t>
  </template>

</odoo>